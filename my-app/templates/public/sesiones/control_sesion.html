{% extends 'public/base_cpanel.html' %}
{% block title %}Control en Tiempo Real{% endblock %}

{% block body %}
<div class="container mt-4">
  <h2 class="text-center mb-4">🎧 Panel de Control</h2>

  <!-- 🔊 Contenedor Superior: Sonidos y Modos -->
  <div class="mb-4 border p-3 rounded">
    <div class="row">
      
      <!-- Columna Izquierda: Hamaca + Originales -->
      <div class="col-md-6 border-end">
        <!-- Sonidos Hamaca -->
        <div class="mb-3">
          <h4 class="text-center">Sonidos Hamaca</h4>
          <div class="d-flex justify-content-center gap-2">
            <button class="btn btn-danger exclusivo-btn" data-group="animal_amaca" data-id="pato">🦆 Pato</button>
            <button class="btn btn-danger exclusivo-btn" data-group="animal_amaca" data-id="perro">🐶 Perro</button>
            <button class="btn btn-danger exclusivo-btn" data-group="animal_amaca" data-id="vaca">🐮 Vaca</button>
          </div>
        </div>
        
        <!-- Modos Originales -->
        <div>
          <div class="d-flex justify-content-center gap-2">
            <button class="btn btn-danger toggle-btn" data-id="reposo_on">🎵 Reposo</button>
            <button class="btn btn-danger toggle-btn" data-id="movimiento_on">🎶 Movimiento</button>
          </div>
        </div>
      </div>
      
      <!-- Columna Derecha: Silla + Alternativas -->
      <div class="col-md-6">
        <!-- Sonidos Silla -->
        <div class="mb-3">
          <h4 class="text-center">Sonidos Silla</h4>
          <div class="d-flex justify-content-center gap-2">
            <button class="btn btn-danger exclusivo-btn" data-group="animal_silla" data-id="pato_silla">🦆 Pato </button>
            <button class="btn btn-danger exclusivo-btn" data-group="animal_silla" data-id="perro_silla">🐶 Perro </button>
            <button class="btn btn-danger exclusivo-btn" data-group="animal_silla" data-id="vaca_silla">🐮 Vaca </button>
          </div>
        </div>
        
        <!-- Modos Alternativos -->
        <div>
          <div class="d-flex justify-content-center gap-2">
            <button class="btn btn-danger toggle-btn" data-id="musica_amaca">🎵 Reposo</button>
            <button class="btn btn-danger toggle-btn" data-id="musica_silla">🎶 Movimiento</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 🔊 Contenedor Volumen (debajo) -->
  <div class="mb-4 border p-3 rounded">
    <h4 class="text-center mb-3">🔊 Control de Volumen</h4>
    <div class="text-center">
      <input type="range" id="volumen_musica" min="0" max="100" value="50" class="form-range w-50 mx-auto">
      <label for="volumen_musica" class="d-block mt-2">Ajuste de volumen principal</label>
    </div>
  </div>

  <!-- 🎨 Bloque Luces y Animaciones (se mantiene igual) -->
  <div class="mb-4 border p-3 rounded">
    <h4 class="text-center">💡 Luces y Animaciones</h4>
    <div class="text-center mb-3">
      <button class="btn btn-danger exclusivo-btn" data-group="animacion" data-id="arcoiris">🌈</button>
      <button class="btn btn-danger exclusivo-btn" data-group="animacion" data-id="fuego">🔥</button>
      <button class="btn btn-danger exclusivo-btn" data-group="animacion" data-id="ola">🌊</button>
      <button class="btn btn-danger exclusivo-btn" data-group="animacion" data-id="teatro">🎭</button>
      <button class="btn btn-danger exclusivo-btn" data-group="animacion" data-id="meteoro">🌌</button>
      <button class="btn btn-danger exclusivo-btn" data-group="animacion" data-id="respiracion">💨</button>
    </div>

    <div class="text-center mb-3">
      <label for="intensidad_luz">💡 Intensidad Luz</label>
      <input type="range" id="intensidad_luz" min="0" max="100" value="50" class="form-range" style="width: 250px;">
    </div>

    <div class="text-center mb-3">
      <label for="velocidad_animacion">🎞️ Velocidad Animación</label>
      <input type="range" id="velocidad_animacion" min="1" max="100" value="50" class="form-range" style="width: 250px;">
    </div>

    <div class="text-center mb-3">
      <input type="color" id="color_selector" title="Color Luz">
    </div>

    <div class="text-center">
      <button class="btn btn-danger toggle-btn" data-id="reposo_luz">📄 Luz Reposo</button>
      <button class="btn btn-danger toggle-btn" data-id="movimiento_luz">🚪 Luz Movimiento</button>
      <button class="btn btn-danger toggle-btn" data-id="apagar_luces">⛔️ Apagar Luces</button>
    </div>
  </div>

  <!-- 🔒 Control General -->
  <div class="text-center">
    <button class="btn btn-secondary" id="btn_bloquear">🔒 Bloquear</button>
    <button class="btn btn-success d-none" id="btn_desbloquear">🔓 Desbloquear</button>
  </div>
</div>

<script>
  const bloquearControles = () => {
    document.querySelectorAll(".btn, input[type=range], input[type=color]").forEach(e => {
      if (!e.classList.contains("no-bloquear") && !e.id.includes("btn_")) {
        e.setAttribute("disabled", true);
      }
    });
    document.getElementById("btn_bloquear").classList.add("d-none");
    document.getElementById("btn_desbloquear").classList.remove("d-none");
  };

  const desbloquearControles = () => {
    document.querySelectorAll(".btn, input[type=range], input[type=color]").forEach(e => {
      e.removeAttribute("disabled");
    });
    document.getElementById("btn_bloquear").classList.remove("d-none");
    document.getElementById("btn_desbloquear").classList.add("d-none");
  };

  document.getElementById("btn_bloquear").addEventListener("click", bloquearControles);
  document.getElementById("btn_desbloquear").addEventListener("click", desbloquearControles);

  // Exclusivos por grupo
  document.querySelectorAll(".exclusivo-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const group = btn.getAttribute("data-group");
      document.querySelectorAll(`.exclusivo-btn[data-group='${group}']`).forEach(b => {
        b.classList.remove("btn-success");
        b.classList.add("btn-danger");
      });
      btn.classList.remove("btn-danger");
      btn.classList.add("btn-success");
    });
  });

  // Botones ON/OFF independientes
  document.querySelectorAll(".toggle-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const isActive = btn.classList.contains("btn-success");
      btn.classList.toggle("btn-success", !isActive);
      btn.classList.toggle("btn-danger", isActive);
    });
  });

  // Slider color dinámico
  const volumenMusica = document.getElementById("volumen_musica");
  volumenMusica.addEventListener("input", () => {
    volumenMusica.style.accentColor = volumenMusica.value > 80 ? 'red' : 'blue';
  });
</script>
{% endblock %}